- name: create ad password 
  azure_rm_password:
    app_id: "{{ app_id }}"
    value: "Password@032900001"
    tenant: "{{ tenant_id }}"
    state: present
  register: ad_fact

- assert:
    that:
         - ad_fact.changed

- name: can't update ad password
  azure_rm_password:
    app_id: "{{ app_id }}"
    value: "Password@032900002"
    tenant: "{{ tenant_id }}"
    key_id: "{{ ad_fact.key_id }}"
    state: present
  register: output
  ignore_errors: True

- name: Get ad password info
  azure_rm_password_info:
    app_id: "{{ app_id }}"
    tenant: "{{ tenant_id }}"
    key_id: "{{ ad_fact.key_id }}"
  register: ad_info

- assert:
    that:
        - ad_info.passwords[0].start_date == ad_fact.start_date
        - ad_info.passwords[0].end_date == ad_fact.end_date

- name: delete all ad password
  azure_rm_password:
    app_id: "{{ app_id }}"
    tenant: "{{ tenant_id }}"
    state: absent
  register: output

- assert:
    that:
        - output.changed

